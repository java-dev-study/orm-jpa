# 6. 다양한 연관관계 매핑

### 엔티티의 연관관계를 매핑할 때 고려해야하는 3가지

- 다중성
- 다대일 : @ManyToOne
- 일대다 : @OneToMany
- 일대일 : @OneToOne
- 다대다 : @ManyToMany

- 단방향, 양방향
 - 테이블 : 외래키 하나로 양쪽 조인 가능, 사실 방향이라는 개념이 없다.
 - 객체 : 참조형 필드가 있어야 참조가 가능하다. 한쪽만 참조하면 단방향, 
    양쪽 양방향

- 연관 관계의 주인

      - 테이블은 외래 키 하나로 두 테이블이 연관관계를 맺음
      - 객체 양방향 관계는 A→B , B→A 처럼 참조가 2군데
      - 객체 양방향 관계는 참조가 2군데 있음. 둘 중 테이블의 외래키를 관리할 곳 지정
      -  연관관계의 주인 : 외래 키를 관리하는 참조
      -  주인의 반대편 : 외래 키에 영향을 주지 않음, 단순 조회만 가능하다.

다대일  @ManyToOne

- 외래 키가 있는 쪽이 연관관계의 주인
- 양쪽을 서로 참조하도록 개발

일대다  @OneToMany

- 일대다 단방향은 일대다 에서 일 이 연관관계의 주인
- 테이블 일대다 관계는 항상 다 쪽에 외래 키가 있음
- 객체와 테이블의 차이 때문에 반대편 테이블의 외래키를 관리하는 특이한 구조
- @JoinColumn을 꼭 사용해야한다. 그렇지 않으면 조인 테이블 방식을 사용한다. (중간에 테이블을 추가한다.)

단점 : 엔티티가 관리하는 외래 키가 다른 테이블에 있음, 연관관계 관리를 위해 추가로 Update 쿼리 실행

- 일대다 단방향 매핑보다는 다대일 양방향 매핑을 사용하자

일대일  @OneToOne

- 일대일 관계는 그 반대도 일대일
- 주 테이블이나 대상 테이블 중에 외래 키 선택 가능
- 주, 대상 테이블 어디든 넣어도 상관 없다.
- 외래 키에 데이터베이스 유니크 제약조건 추가.
- mappedBy의 원리는 똑같다. (읽기 전용)

다대다 @ManyToMany

- 실무에서 사용하지 않기
- 다대다는 각각 일대다, 다대일 로 변경해서 사용
- 연결 테이블용 엔티티 추가해야함 → 실무에서 사용 X

복합 기본 키

- JPA에서 복합 키를 사용하려면 별도의 식별자 클래스를 만들어야 함. 
그리고 엔티티에 @IdClass를 사용해서 식별자 클래스를 지정 필요
- 복합 키는 별도의 식별자 클래스 필요, public
- Serializable, equals, hashcode 메소드
- 기본 생성자
- IdClass와 @Embeddedld 중 선택

식별 관계

- 부모 테이블의 기본 키를 받아 자신의 기본키+외래키로 사용하는 것

비식별 관계

- 받아온 식별자는 외래 키로만 사용, 새로운 식별자 추가
- 식별 관계보다는 비식별 관계를 추천한다.