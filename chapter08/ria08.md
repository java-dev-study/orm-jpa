## Chapter08 프록시와 연관관계 관리

### 8.1 프록시

- JPA는 프록시 객체를 사용하여 지연 로딩을 지원함
- 프록시 객체는 실제 객체에 대한 참조를 보관하며, 프록시 객체의 메소드 호출 시 실제 객체의 메소드를 호출함
- 단, 조회 대상이 이미 영속성 컨텍스트에 있을 경우 프록시 객체를 사용하지 않고 실제 객체를 사용함

### 8.2 즉시 로딩과 지연 로딩

- 즉시 로딩 : 엔티티 조회 시 연관된 엔티티 함께 조회
  - 조인 쿼리 한 번에 연관된 엔티티 조회 가능

- 지연 로딩 : 연관된 엔티티를 실제 사용할 때 조회

### 8.3 지연 로딩 활용

- 모든 연관관계에 지연 로딩을 사용하되, 꼭 필요한 곳에만 즉시 로딩 사용을 권장함

### 8.4 영속성 전이 : CASCADE

- 특정 엔티티를 영속 상태로 만들 때 연관된 엔티티도 함께 영속 상태로 만들고 싶은 경우  영속성 전이 기능 사용
  - 부모 엔티티 저장 시 자식 엔티티도 함께 저장 가능
- `cascade=CascadeType.PERSIST)` : 영속성 전이 저장
- `cascade=CascadeType.REMOVE)` : 영속성 전이 삭제
  - 외래키 제약조건을 고려해서 자식 삭제 후 부모 삭제

### 8.5 고아 객체

- JPA는 부모 엔티티의 컬렉션에서 자식 엔티티의 참조만 제거하면 자식 엔티티가 자동으로 삭제되는 고아 객체 제거 기능을 제공함
  - `orphanRemoval=true`
- 고아 객체 제거 기능은 영속성 컨텍스트를 플러시할 때 적용되므로 플러시 시점에 delete sql이 실행됨
- 고아 객체 제거 기능은 참조하는 곳이 하나뿐인 @OneToOne, @OneToMany에서만 사용 가능

### 8.6 영속성 전이 + 고아 객체, 생명주기

- `CascadeType.ALL + orphanRemoval = true 옵션을 동시에 활성화하면 부모 엔티티를 통해 자식의 생명주기를 관리할 수 있음