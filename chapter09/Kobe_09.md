# 9. 값 타입

### JPA에서의 데이터 타입

- JPA의 데이터 타입을 가장 크게 분류하면 엔티티 타입과 값 타입으로 나눌 수 있다.
- 엔티티 타입 (@Entity 타입) -  데이터가 변해도 식별자를 통해서 인식 가능
- 값 타입 (int,Integer,String)처럼 단순히 값으로 사용하는 자바 기본 타입, 객체
- 식별자를 가지고 있는것이 아니기 때문에 값이 변경되면 추적 불가능

**값 타입 분류**

- 기본 값 타입

       - 자바 기본 타입

       -  래퍼 클래스 

       -   String

- 임베디드 타입 복합 값 타입
- 컬렉션 값 타입

### 기본 값 타입

- 생명 주기를 엔티티에 의존한다.
 - 회원을 삭제하면 이름, 나이 필드도 함께 삭제된다.
- 값 타입은 공유하면 안된다.
- Side Effect가 발생할 수 있기 때문이다.
- 회원 이름 변경시 다른 회원의 이름도 함께 변경되면 안된다.
- 자바의 기본 타입은 절대 공유 X

### 임베디드 타입 (복합 값 타입)

- 새로운 값을 직접 정의해서 사용할 수 있는데, JPA에서는 이것을 입베디드 타입이라고 한다.
- 주로 기본 값 타입을 모아서 사용하기 떄문에 복합 값 타입이라고 한다.
- @Embeddable : 값 타입을 정의하는 곳에 표시 , @Embedded : 값 타입을 사용하는 곳에 표시
- 컴포지션 관계 - 엔티티와 임베디드 타입의 관계를 UML로 표시

 

### 임베디드 타입과 테이블 매핑

- 임베디드 타입은 엔티티의 값일 뿐이다. 그래서 임베디드 타입은 값이 속한 엔티티 테이블에 해당 값을 매핑한다.
- 입베디드 타입을 사용하기 전과 후의 테이블 매핑은 같다. 그냥 값이 임베디드 타입으로 바뀐 것 뿐.
객체와 테이블을 세밀하게 매핑할 수 있다.

### 임베디드 타입과 연관관계

- 임베디드 타입은 임베디드 타입을 가질 수 있다.
- 임베디드 타입은 엔티티 타입을 가질 수 있다.

### @AttributeOverride : 속성 재정의

- 임베디드 타입에 정의한 매핑 정보를 재정의 하려면, 엔티티에 @AttributeOverride를 사용하면 된다.
- 회원에게 주소가 더 필요하다면??
같은 Address 형식이리마면 @AttributeOverride, @AttributeOverrides 를 사용하면 된다.

**임베디드 타입이 Null이라면 매핑한 컬럼 값은 모두 null 이 된다.** (임베디드 타입 안에 있는 칼럼 모두 null)

### 값 타입과 불변 객체

값 타입은 복잡한 객체 세상을 조금이라도 단순화 하기 위해 만든 개념이다. 따라서 값 타입은 단순하고 안전하게 다뤄야 한다.

**값 타입 공유 참조**

- 같은 임베디드 타입을 여러 엔티티에서 공유하면 위험하다.
- 원하지 않는 엔티티의 값 까지 변경될 수 있다.

**값 타입 복사**

- 위의 예시처럼 값 타입의 실제 인스턴스인 값을 공유하는 것이 굉장히 위험하다.
- 그래서 값을 복사해서 사용한다. → 복사 한 이후에 적용 
계속 복사를 통해서 값을 다루다 보면 공유 참조로 인해 발생하는 부작용을 피하기 어렵다.
임베디드 타입과 같이 직접 정의한 값  타입은 객체 타입이다. 객체를 통해 다루게 된다면 복사를 통해서 공유 참조를 피할수 있지만. 복사하지 않고 원본의 참조 값을 직접 넘기는 것을 막을 방법이 없다.

**불변 객체**

- 값 타입은 위와 같은 부작용 걱정 없이 사용할 수 있어야 한다. 부작용이 일어나면 값 타입이라 할 수 없다.
- 객체를 불변으로 만들면 값을 수정할 수 없기 때문에, 부작용을 차단할 수 있다. → 값 타입은 되도록 불변 객체로 설계
- 생성자로 값을 설정하고 setter 사용 금지, 수정 금지

**값 타입의 비교**

- 값 타입은 인스턴스가 달라도 값이 같으면 같다고 판단 ==
- 객체 타입은 값이 같아도 주소가 달라 == 로 판단 X 
값 → == , 객체 → equals()
- 동일성 비교 : 인스턴스의 참조 값을 비교 ==
- 동등성 비교 : 인스턴스의 값을 비교, equals()

**값 타입 컬렉션 : 값 타입을 여러 개 저장하고자 할 때 사용하고, 컬렉션 사용**

@ElementCollection , @CollectionTable 사용